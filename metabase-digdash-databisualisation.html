<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Datavisualisation – Metabase & PostgreSQL (Docker)</title>

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700|Raleway:300,400,500,600,700|Poppins:300,400,500,600,700" rel="stylesheet">

  <!-- Vendor CSS -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/icofont/icofont.min.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/venobox/venobox.css" rel="stylesheet">
  <link href="assets/vendor/owl.carousel/assets/owl.carousel.min.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">

  <!-- Main CSS -->
  <link href="assets/css/style.css" rel="stylesheet">

  <style>
    /* Accordéons "FAQ" */
    .faq-item { border-bottom: 1px solid #e9ecef; padding: 14px 0; }
    .question { cursor: pointer; font-weight: 600; padding-right: 24px; position: relative; }
    .answer   { max-height: 0; overflow: hidden; transition: max-height .3s ease; }
    .arrow-icon { position: absolute; right: 0; top: 0; transition: transform .3s ease; }
    .answer-visible .arrow-icon { transform: rotate(180deg); }
  </style>
</head>

<body>
<main id="main">
  <!-- ======= Portfolio Details ======= -->
  <section id="portfolio-details" class="portfolio-details">
    <div class="container" data-aos="fade-up">

      <div class="row">
        <!-- Colonne gauche : titre + carrousel -->
        <div class="col-lg-8">
          <h2 class="portfolio-title" style="text-align:center;color:#007bff">
            Datavisualisation – Metabase & PostgreSQL (Docker Compose)
          </h2>

          <div class="owl-carousel portfolio-details-carousel">
            <!-- Remplace/complète ces images par tes captures -->
            <img src="assets/img/digdash6.jpg" class="img-fluid" alt="Capture Metabase 1">
            <img src="assets/img/digdash 4.png" class="img-fluid" alt="Capture Metabase 2">
            <img src="assets/img/digdash5.jpg" class="img-fluid" alt="Capture Metabase 3">
             <img src="assets/img/digdash7.jpg" class="img-fluid" alt="Capture Metabase 3">
             <img src="assets/img/digdash8.jpg" class="img-fluid" alt="Capture Metabase 3">
          </div>
        </div>

        <!-- Colonne droite : résumé projet -->
        <div class="col-lg-4 portfolio-info">
          <h3 style="text-align:center"><strong>Subventions : dashboard Metabase dockerisé</strong></h3>
          <ul>
            <li><strong>Catégorie</strong> : Application / DataViz</li>
            <li><strong>Stack</strong> : Docker Compose, PostgreSQL 15, Metabase</li>
            <li><strong>Contexte</strong> : VM Debian 12 (local)</li>
            <li><strong>Livrables</strong> : BDD de démo, questions Metabase, dashboard, scripts de sauvegarde</li>
          </ul>
          <p>
            Mise en place d’une chaîne locale de datavisualisation pour suivre les
            subventions (montants, saisonnalités, répartitions par organisme et finalité).
            L’infra est décrite en Docker Compose, les données sont injectées via SQL,
            et les tableaux de bord sont partagés depuis Metabase.
          </p>
        </div>

        <!-- ======= Accordéons détaillés ======= -->
        <div class="col-lg-12 portfolio-info">

          <!-- Architecture & Docker -->
          <div class="faq-item">
            <div class="question" onclick="toggleAnswer('a1', this)">
              Architecture & Docker Compose
              <span class="arrow-icon">▼</span>
            </div>
            <div class="answer" id="a1">
              <p><strong>Objectif :</strong> avoir un environnement jetable et reproductible
              (infra locale “as code”). Deux services : <em>postgres</em> + <em>metabase</em>,
              volumes persistants, même réseau Docker.</p>

<pre><code class="language-yaml"># docker-compose.yml (extrait simplifié)
version: "3.8"
services:
  db:
    image: postgres:15
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: subventions_db
    ports: ["5432:5432"]
    volumes:
      - pgdata:/var/lib/postgresql/data
      - ./sql:/docker-entrypoint-initdb.d
    restart: unless-stopped

  metabase:
    image: metabase/metabase:latest
    ports: ["3000:3000"]
    depends_on: [db]
    environment:
      MB_DB_TYPE: postgres
      MB_DB_DBNAME: subventions_db
      MB_DB_PORT: 5432
      MB_DB_HOST: db
      MB_DB_USER: postgres
      MB_DB_PASS: postgres
    volumes:
      - metabase-data:/metabase-data
    restart: unless-stopped
volumes:
  pgdata:
  metabase-data:
</code></pre>

              <p>
                <em>Lancement :</em> <code>docker compose up -d</code> puis accès à Metabase
                sur <code>http://localhost:3000</code>.
              </p>
            </div>
          </div>

          <!-- Données & SQL -->
          <div class="faq-item">
            <div class="question" onclick="toggleAnswer('a2', this)">
              Modèle de données & chargement
              <span class="arrow-icon">▼</span>
            </div>
            <div class="answer" id="a2">
              <p>
                Schéma minimaliste : table <code>subventions</code> (<code>id</code>, <code>organisme</code>,
                <code>objet</code>, <code>montant</code>, <code>date_versement</code>), alimentée par
                un script SQL étendu pour simuler plusieurs années et organismes.  
                <em>Import :</em>
              </p>
<pre><code class="language-bash"># (si nécessaire) docker cp extended_subventions.sql dans ./sql/
docker compose exec -T db psql -U postgres -d subventions_db \
  -f /docker-entrypoint-initdb.d/extended_subventions.sql
</code></pre>
              <p>
                Dans Metabase : connexion à la base, typage des colonnes (date, nombre),
                création des “Questions” puis assemblage en Dashboard (évolution mensuelle,
                top organismes, répartition par finalité, etc.).
              </p>
            </div>
          </div>

          <!-- Backups -->
          <div class="faq-item">
            <div class="question" onclick="toggleAnswer('a3', this)">
              Sauvegarde & restauration (pg_dump)
              <span class="arrow-icon">▼</span>
            </div>
            <div class="answer" id="a3">
              <p>
                Stratégie simple : dump quotidien + rétention 7 jours.
                Script stocké côté hôte, exécuté via cron.
              </p>
<pre><code class="language-bash">#!/usr/bin/env bash
set -euo pipefail
STAMP=$(date +%Y%m%d_%H%M)
OUT="backups/subventions_${STAMP}.sql"
mkdir -p backups

# Dump de la base "subventions_db"
docker compose exec -T db pg_dump -U postgres subventions_db &gt; "$OUT"

# Rétention 7 jours
find backups -type f -name "subventions_*.sql" -mtime +7 -delete
echo "Backup OK -&gt; $OUT"
</code></pre>

<pre><code class="language-bash"># Cron (exemple) : tous les jours à 02h15
15 2 * * * /bin/bash /chemin/vers/backup.sh &gt;&gt; /chemin/vers/backup.log 2&gt;&1
</code></pre>

<pre><code class="language-bash"># Restauration
docker compose exec -T db psql -U postgres -d subventions_db &lt; backups/subventions_YYYYMMDD_HHMM.sql
</code></pre>
            </div>
          </div>

          <!-- Sécurité / Observabilité -->
          <div class="faq-item">
            <div class="question" onclick="toggleAnswer('a4', this)">
              Sécurité & Observabilité minimales
              <span class="arrow-icon">▼</span>
            </div>
            <div class="answer" id="a4">
              <ul>
                <li>Variables d’env. via fichier <code>.env</code> (éviter les secrets en clair).</li>
                <li>Volumes persistants (<code>pgdata</code>, <code>metabase-data</code>) pour l’état.</li>
                <li>Logs : <code>docker compose logs -f db|metabase</code>, et export si besoin.</li>
                <li>Accès Metabase restreint au LAN / reverse-proxy avec auth si exposition.</li>
              </ul>
            </div>
          </div>

          <!-- Résultats -->
          <div class="faq-item">
            <div class="question" onclick="toggleAnswer('a5', this)">
              Résultats & livrables
              <span class="arrow-icon">▼</span>
            </div>
            <div class="answer" id="a5">
              <ul>
                <li>Dashboard sur l’évolution mensuelle, les Top organismes et
                    la répartition par finalité.</li>
                <li>Pipeline reproductible (Compose) + dataset de démonstration.</li>
                <li>Scripts d’initialisation et de sauvegarde documentés.</li>
              </ul>
            </div>
          </div>

        </div>
        <!-- /col-12 -->
      </div>
    </div>
  </section>
</main>

<a href="#" class="back-to-top"><i class="bx bx-up-arrow-alt"></i></a>
<div id="preloader"></div>

<!-- Vendor JS -->
<script>
  function toggleAnswer(id, el){
    const a = document.getElementById(id);
    a.classList.toggle("answer-visible");
    el.classList.toggle("answer-visible");
    a.style.maxHeight = a.style.maxHeight ? null : (a.scrollHeight + "px");
  }
</script>
<script src="assets/vendor/jquery/jquery.min.js"></script>
<script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="assets/vendor/jquery.easing/jquery.easing.min.js"></script>
<script src="assets/vendor/php-email-form/validate.js"></script>
<script src="assets/vendor/waypoints/jquery.waypoints.min.js"></script>
<script src="assets/vendor/counterup/counterup.min.js"></script>
<script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
<script src="assets/vendor/venobox/venobox.min.js"></script>
<script src="assets/vendor/owl.carousel/owl.carousel.min.js"></script>
<script src="assets/vendor/typed.js/typed.min.js"></script>
<script src="assets/vendor/aos/aos.js"></script>
<script src="assets/js/main.js"></script>
</body>
</html>
