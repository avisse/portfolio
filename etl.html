<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>POC ETL – Apache Hop + MariaDB (Docker)</title>
  <style>
    :root{
      --bg:#f7f8fb;
      --card:#ffffff;
      --text:#1f2937;
      --muted:#6b7280;
      --accent:#2563eb;
      --border:#e5e7eb;
      --code-bg:#f7f7f9;      /* plus clair */
      --code-text:#222;       /* texte foncé lisible */
    }
    html,body{margin:0;background:var(--bg);color:var(--text);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Noto Sans",Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";}
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}
    .container{max-width:1100px;margin:auto;padding:24px}
    header.hero{background:linear-gradient(180deg,#eef4ff,transparent);padding:32px 0 8px}
    .hero h1{margin:0 0 8px;font-size:clamp(28px,5vw,40px)}
    .hero p{margin:0;color:var(--muted)}
    .grid{display:grid;gap:20px}
    .grid.two{grid-template-columns:repeat(2,minmax(0,1fr))}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:18px}
    h2{margin:18px 0 6px;font-size:22px}
    h3{margin:14px 0 4px;font-size:18px}
    .pill{display:inline-block;padding:4px 10px;border:1px solid var(--border);border-radius:999px;background:#fff; color:#374151;font-size:12px}
    figure{margin:0}
    .shot{display:block;width:100%;height:auto;border:1px solid var(--border);border-radius:12px;background:#fff}
    .shots{display:grid;gap:16px}
    .shots.cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}
    .shots.cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}
    .caption{margin-top:6px;font-size:13px;color:var(--muted)}
    pre{background:var(--code-bg);color:var(--code-text);padding:14px;border-radius:12px;border:1px solid var(--border);overflow:auto}
    code{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
    .btns{display:flex;flex-wrap:wrap;gap:10px;margin-top:8px}
    .btn{display:inline-block;padding:10px 14px;border-radius:10px;border:1px solid var(--border);background:#fff}
    .btn.primary{background:var(--accent);border-color:var(--accent);color:#fff}
    details{border:1px solid var(--border);border-radius:12px;background:#fff}
    details>summary{cursor:pointer;padding:12px 14px;font-weight:600}
    details .content{padding:0 14px 14px}
    footer{color:var(--muted);font-size:14px;padding:22px 0}
    @media (max-width:900px){.grid.two{grid-template-columns:1fr}}
  </style>
</head>
<body>

  <header class="hero">
    <div class="container">
      <span class="pill">ETL • Apache Hop • MariaDB • Docker</span>
      <h1>POC ETL : ingestion CSV → MariaDB avec Apache Hop (Docker)</h1>
      <p>
        Objectif : livrer rapidement un POC opérationnel pour démontrer la chaîne ETL
        (ingestion, transformation, chargement) en <strong>Docker</strong> avec
        <strong>Apache Hop Web</strong> et <strong>MariaDB</strong>, plus un outil de
        visualisation <strong>Adminer</strong>.
      </p>
      <div class="btns">
        <a class="btn primary" href="#recap">Résumé du projet</a>
        <a class="btn" href="#screens">Captures clés</a>
      </div>
    </div>
  </header>

  <main class="container">

    <section id="recap" class="card">
      <h2>Résumé</h2>
      <p>
        Le besoin business : disposer d’une mini-chaîne ETL prête à l’emploi (type démonstrateur) pour
        charger un fichier <em>CSV</em> d’agents vers <em>MariaDB</em>, pilotée via <em>Apache Hop Web</em>.
        Le tout devait tenir dans un <strong>docker-compose</strong> simple à lancer, avec un schéma DB préparé
        automatiquement et un back-office SQL (Adminer) pour vérifier le résultat.
      </p>
      <ul>
        <li><strong>Livrable principal</strong> : pipeline Apache Hop « CSV → Table output » (10 lignes de test)</li>
        <li><strong>Accès & contrôle</strong> : Adminer pour vérifier la structure et les données</li>
        <li><strong>Provisioning</strong> : <code>init.sql</code> créé au démarrage (tables <code>agents</code> et <code>agents_staging</code>)</li>
      </ul>
    </section>

    <section class="grid two">
      <div class="card">
        <h2>Architecture & environnement</h2>
        <p>Un seul <code>docker-compose.yml</code> orchestre :</p>
        <ul>
          <li><strong>mariadb</strong> – base <code>etl_demo</code> (port <code>3307→3306</code>)</li>
          <li><strong>adminer</strong> – UI SQL (port <code>8081</code>)</li>
          <li><strong>hopweb</strong> – Apache Hop Web (port <code>8086</code>)</li>
        </ul>
        <details>
          <summary>Extrait <code>docker-compose.yml</code> (simplifié)</summary>
          <div class="content">
<pre><code># Ports & volumes (extrait)
mariadb:
  image: mariadb:10.11
  ports: ["3307:3306"]
  environment:
    - MARIADB_DATABASE=etl_demo
    - MARIADB_USER=etl_user
    - MARIADB_PASSWORD=etl_pwd
    - MARIADB_ROOT_PASSWORD=root_pwd
  volumes:
    - ./init.sql:/docker-entrypoint-initdb.d/init.sql:ro

adminer:
  image: adminer
  ports: ["8081:8080"]

hopweb:
  image: apache/hop-web
  ports: ["8086:8080"]
</code></pre>
          </div>
        </details>
        <p class="caption">Lancement : <code>docker compose up -d</code>.</p>
      </div>

      <div class="card">
        <h2>Données & schéma</h2>
        <p>Un fichier CSV simple (<code>data/agents.csv</code>) alimente deux tables :</p>
        <ul>
          <li><code>agents</code> (cible)</li>
          <li><code>agents_staging</code> (tampon technique)</li>
        </ul>
        <details>
          <summary>Préparation du schéma via <code>init.sql</code></summary>
          <div class="content">
<pre><code>-- Tables cibles/staging créées au démarrage
CREATE TABLE IF NOT EXISTS agents (...);
CREATE TABLE IF NOT EXISTS agents_staging (...);
</code></pre>
          </div>
        </details>
      </div>
    </section>

    <section id="screens" class="card">
      <h2>Captures clés</h2>

      <h3>1) Démarrage et images Docker</h3>
      <figure class="shots">
        <a href="assets/img/docker ok .png" target="_blank">
          <img class="shot" src="assets/img/docker ok .png" alt="docker compose OK">
        </a>
        <figcaption class="caption">Images récupérées et conteneurs up.</figcaption>
      </figure>

      <div class="shots cols-2" style="margin-top:14px">
        <figure>
          <a href="assets/img/istalation hop-project.png" target="_blank">
            <img class="shot" src="assets/img/istalation hop-project.png" alt="Téléchargements Docker">
          </a>
          <figcaption class="caption">Installation des images (journal).</figcaption>
        </figure>
        <figure>
          <a href="assets/img/run du scenario.png" target="_blank">
            <img class="shot" src="assets/img/run du scenario.png" alt="Run Hop scénario">
          </a>
          <figcaption class="caption">Run Hop réussi (logging).</figcaption>
        </figure>
      </div>

      <hr style="border:none;border-top:1px solid var(--border);margin:22px 0">

      <h3>2) Adminer (contrôle DB)</h3>
      <div class="shots cols-2">
        <figure>
          <a href="assets/img/adminer .png" target="_blank">
            <img class="shot" src="assets/img/adminer .png" alt="Adminer page d'accueil">
          </a>
          <figcaption class="caption">Adminer accessible sur <code>localhost:8081</code>.</figcaption>
        </figure>
        <figure>
          <a href="assets/img/connection base ok succes.png" target="_blank">
            <img class="shot" src="assets/img/connection base ok succes.png" alt="Connexion DB OK">
          </a>
          <figcaption class="caption">Connexion <code>etl_user</code> → <code>etl_demo</code> validée.</figcaption>
        </figure>
      </div>

      <div class="shots cols-2" style="margin-top:14px">
        <figure>
          <a href="assets/img/structure de ta table agents avec les nouvelle ligne chargé.png" target="_blank">
            <img class="shot" src="assets/img/structure de ta table agents avec les nouvelle ligne chargé.png" alt="Structure table agents avec données">
          </a>
          <figcaption class="caption">Table <code>agents</code> après chargement (10 lignes).</figcaption>
        </figure>
        <figure>
          <a href="assets/img/ligne charge donc etl ok .png" target="_blank">
            <img class="shot" src="assets/img/ligne charge donc etl ok .png" alt="Lignes chargées OK">
          </a>
          <figcaption class="caption">Vérification des lignes chargées.</figcaption>
        </figure>
      </div>

      <hr style="border:none;border-top:1px solid var(--border);margin:22px 0">

      <h3>3) Hop Web – configuration & pipeline</h3>
      <div class="shots cols-3">
        <figure>
          <a href="assets/img/interface.png" target="_blank">
            <img class="shot" src="assets/img/interface.png" alt="Interface Hop Web">
          </a>
          <figcaption class="caption">Hop Web accessible sur <code>localhost:8086</code>.</figcaption>
        </figure>
        <figure>
          <a href="assets/img/creat hop.png" target="_blank">
            <img class="shot" src="assets/img/creat hop.png" alt="Création pipeline Hop">
          </a>
          <figcaption class="caption">Création d’une pipeline.</figcaption>
        </figure>
        <figure>
          <a href="assets/img/csv file input.png" target="_blank">
            <img class="shot" src="assets/img/csv file input.png" alt="CSV file input">
          </a>
          <figcaption class="caption">Transform « CSV file input » paramétré.</figcaption>
        </figure>
      </div>

      <div class="shots cols-3" style="margin-top:14px">
        <figure>
          <a href="assets/img/paramétrage etl vers base.png" target="_blank">
            <img class="shot" src="assets/img/paramétrage etl vers base.png" alt="Connexion DB Hop">
          </a>
          <figcaption class="caption">Connexion relationnelle Hop → MariaDB.</figcaption>
        </figure>
        <figure>
          <a href="assets/img/paramétrage table output.png" target="_blank">
            <img class="shot" src="assets/img/paramétrage table output.png" alt="Table output paramétrage">
          </a>
          <figcaption class="caption">Transform « Table output » vers <code>agents</code>.</figcaption>
        </figure>
        <figure>
          <a href="assets/img/SQL editor de Table output..png" target="_blank">
            <img class="shot" src="assets/img/SQL editor de Table output..png" alt="SQL editor Table output">
          </a>
          <figcaption class="caption">Éditeur SQL embarqué pour ajustements.</figcaption>
        </figure>
      </div>

      <figure style="margin-top:14px">
        <a href="assets/img/csv_to_staging_agents.hpl.png" target="_blank">
          <img class="shot" src="assets/img/csv_to_staging_agents.hpl.png" alt="Pipeline CSV → staging agents">
        </a>
        <figcaption class="caption">
          Pipeline « csv_to_staging_agents.hpl » (version staging). La variante « CSV → agents » est identique côté flux.
        </figcaption>
      </figure>
    </section>

    <section class="grid two" style="margin-top:20px">
      <div class="card">
        <h2>Résultat</h2>
        <ul>
          <li>Pipeline Hop opérationnelle (10 lignes insérées).</li>
          <li>Adminer confirme structure & données.</li>
          <li>Le tout se lance et s’arrête en 1 commande Docker.</li>
        </ul>
      </div>
      <div class="card">
        <h2>Petites difficultés & contournements</h2>
        <ul>
          <li>Driver MariaDB dans Hop → on a pointé <em>host.docker.internal:3307</em> et choisi « Mysql 8+ » (ok MariaDB).</li>
          <li>Champ Date : format strict (ex. <code>yyyy-MM-dd</code>) côté CSV/Hop.</li>
          <li>Noms de fichiers avec espaces/accents → conservés tels quels (side note : à éviter en prod).</li>
        </ul>
      </div>
    </section>

    <footer>
      Projet Dockerisé, reproductible en quelques minutes.  
      Démarrage : <code>docker compose up -d</code> — Arrêt : <code>docker compose down</code>.
    </footer>

  </main>
</body>
</html>
