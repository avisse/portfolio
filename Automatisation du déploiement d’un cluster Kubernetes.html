<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>Activité 1 — EKS + Lambda (Terraform)</title>

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon" />
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon" />

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700|Poppins:300,400,500,600,700" rel="stylesheet" />

  <!-- Vendor CSS -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
  <link href="assets/vendor/icofont/icofont.min.css" rel="stylesheet" />
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet" />
  <link href="assets/vendor/venobox/venobox.css" rel="stylesheet" />
  <link href="assets/vendor/owl.carousel/assets/owl.carousel.min.css" rel="stylesheet" />
  <link href="assets/vendor/aos/aos.css" rel="stylesheet" />

  <!-- Template Main CSS -->
  <link href="assets/css/style.css" rel="stylesheet" />

  <style>
    /* Accent & chips */
    :root { --brand:#0a66ff; }
    .chip {
      display:inline-block; padding:.2rem .6rem; border:1px solid rgba(10,102,255,.18);
      background:rgba(10,102,255,.06); color:#1b2a4e; border-radius:999px; font-size:.78rem; margin:0 .25rem .35rem 0;
    }
    .aside-card {
      background:#fff; border:1px solid #e9eef5; border-radius:12px; padding:16px 18px;
      box-shadow:0 8px 20px rgba(2,21,78,.04);
    }
    .aside-card h5 { font-weight:600; color:#334; }
    .kicker { color:#6b7a90; font-size:.95rem; }
    .btn-repo {
      display:inline-flex; align-items:center; gap:.45rem;
      background:var(--brand); color:#fff !important; border:none; border-radius:10px;
      padding:.55rem .9rem; font-weight:600;
      box-shadow:0 10px 18px rgba(10,102,255,.22);
      transition:transform .12s ease;
    }
    .btn-repo:hover { transform:translateY(-1px); }
    .btn-repo i { font-size:1.1rem; }

    /* Accordéons minimalistes */
    .faq-item { border-bottom:1px solid #edf2f7; }
    .question {
      cursor:pointer; padding:16px 6px; font-weight:600; color:#1f2a44; position:relative;
    }
    .question .arrow {
      position:absolute; right:8px; top:50%; transform:translateY(-50%);
      width:22px; height:22px; display:grid; place-items:center;
      color:var(--brand); border-radius:50%;
    }
    .answer { max-height:0; overflow:hidden; transition:max-height .3s ease; }
    .answer-visible { max-height:2200px; }
    .question.answer-visible .arrow { transform:translateY(-50%) rotate(180deg); }

    /* Carousel img fit */
    .portfolio-details-carousel img { border-radius:12px; box-shadow:0 14px 28px rgba(0,0,0,.08); }

    /* Small code blocks */
    pre, code { background:#0f172a; color:#e5e7eb; border-radius:10px; }
    pre { padding:14px 16px; overflow:auto; }
    code { padding:2px 6px; }
  </style>
</head>

<body>
<main id="main">

  <!-- ======= Portfolio Details ======= -->
  <section id="portfolio-details" class="portfolio-details">
    <div class="container" data-aos="fade-up">

      <div class="row">
        <div class="col-lg-8">
          <h2 class="portfolio-title" style="text-align:center; color:var(--brand);">
            Automatisation EKS + Lambda (Terraform) — Free Tier AWS
          </h2>

          <!-- Carousel -->
          <div class="owl-carousel portfolio-details-carousel">
            <img src="assets/img/eks/01_ec2_instance_resume.JPG" class="img-fluid" alt="Résumé instance EC2">
            <img src="assets/img/eks/02_ec2_instance_networking.JPG" class="img-fluid" alt="Réseau EC2 / VPC">
            <img src="assets/img/eks/03_ec2_storage_monitoring.JPG" class="img-fluid" alt="Stockage / monitoring EC2">
            <img src="assets/img/eks/04_eks_cluster_dashboard.JPG" class="img-fluid" alt="Dashboard EKS">
            <img src="assets/img/eks/08_cluster_eks_details.JPG" class="img-fluid" alt="Détails Cluster EKS">
            <img src="assets/img/eks/09_sous_reseau_vpc.JPG" class="img-fluid" alt="Sous-réseau VPC">
            <img src="assets/img/eks/10_vue_globale_sous_reseaux.JPG" class="img-fluid" alt="Vue globale sous-réseaux">
            <img src="assets/img/eks/11_cluster_eks_infoeks_vue_generale.JPG" class="img-fluid" alt="Cluster EKS — vue générale">
            <img src="assets/img/eks/05_lambda_overview.JPG" class="img-fluid" alt="Aperçu fonction Lambda">
            <img src="assets/img/eks/06_lambda_test_event.JPG" class="img-fluid" alt="Test événement Lambda">
            <img src="assets/img/eks/07_lambda_handler_configuration.JPG" class="img-fluid" alt="Configuration handler Lambda">
          </div>
        </div>

        <!-- Aside -->
        <div class="col-lg-4">
          <div class="aside-card">
            <h5>Docker / IaC : EKS + Lambda</h5>
            <p class="kicker">
              Déploiement <b>automatisé</b> d’un cluster <b>Kubernetes (EKS)</b> et d’un service
              <b>serverless (AWS Lambda Java)</b>, orchestré par <b>Terraform</b> depuis une VM <b>EC2</b> (Free Tier).
              Objectif : une infra reproductible, des artefacts propres et un cleanup pour éviter la facturation.
            </p>

            <div class="mb-2">
              <span class="chip">Terraform</span>
              <span class="chip">AWS</span>
              <span class="chip">EC2</span>
              <span class="chip">EKS</span>
              <span class="chip">VPC / Subnets</span>
              <span class="chip">Node Group</span>
              <span class="chip">IAM</span>
              <span class="chip">Lambda (Java 11)</span>
              <span class="chip">Maven</span>
              <span class="chip">PowerShell/SSH</span>
              <span class="chip">Free Tier</span>
              <span class="chip">Troubleshooting</span>
            </div>

            <p class="mb-1"><b>Catégorie :</b> Cloud / DevOps</p>
            <p class="mb-1"><b>Contexte :</b> VM Amazon Linux 2 (t2.micro) — manip’ depuis PowerShell + clé <code>.pem</code>.</p>
            <p class="mb-3"><b>Livrables :</b> fichiers <code>.tf</code> (VPC/EKS/IAM), artefacts Java Lambda, consignes de backup/cleanup.</p>

            <a class="btn-repo" href="https://github.com/avisse?tab=repositories" target="_blank" rel="noopener">
              <i class="bx bxl-github"></i> Voir le repository GitHub
            </a>
          </div>
        </div>
      </div>

      <!-- ======= Accordéons ======= -->
      <div class="row mt-4">
        <div class="col-lg-12">

          <!-- Contexte -->
          <div class="faq-item">
            <div class="question" onclick="toggleAnswer('ans0', this)">
              Contexte & objectifs
              <span class="arrow"><i class="bx bx-chevron-down"></i></span>
            </div>
            <div class="answer" id="ans0">
              <div class="p-2">
                <p>
                  L’objectif : déployer une <b>stack cloud reproductible</b> combinant
                  un <b>cluster EKS</b> (pour exécuter des workloads conteneurisés) et un <b>service AWS
                  Lambda</b> (Java) pour illustrer un pattern <em>serverless</em>, le tout <b>provisionné par Terraform</b>.
                  J’ai volontairement travaillé en <b>Free Tier</b> avec une VM <b>EC2</b> comme poste d’orchestration.
                </p>
                <ul>
                  <li><b>Infra as Code :</b> un seul <em>plan Terraform</em> versionné pour (re)créer la même infra.</li>
                  <li><b>Séparation claire :</b> fichiers <code>provider.tf</code>, <code>variables.tf</code>, <code>main.tf</code>, <code>outputs.tf</code>, <code>iam.tf</code>.</li>
                  <li><b>Explicabilité :</b> captures, logs, et un cleanup strict pour maîtriser les coûts.</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Architecture & Terraform -->
          <div class="faq-item">
            <div class="question" onclick="toggleAnswer('ans1', this)">
              Architecture & Terraform
              <span class="arrow"><i class="bx bx-chevron-down"></i></span>
            </div>
            <div class="answer" id="ans1">
              <div class="p-2">
                <p><b>Vue d’ensemble :</b></p>
                <ul>
                  <li><b>EC2 (poste d’admin)</b> : installation de Docker & Terraform.</li>
                  <li><b>VPC</b> + <b>subnets</b> publics/privés + <b>Route Tables</b> + <b>Security Groups</b>.</li>
                  <li><b>EKS</b> : cluster + <b>Node Group</b> avec IP publique (cf. correctif ci-dessous).</li>
                  <li><b>IAM</b> : rôles & policies pour EKS/Nodes & Lambda.</li>
                  <li><b>Lambda Java</b> : artefact <code>.jar</code> compilé avec Maven, déployé dans AWS.</li>
                </ul>

                <p class="mb-2"><b>Commandes exécutées depuis EC2 :</b></p>
                <pre><code class="language-bash"># Mises à jour + outils
sudo yum update -y
sudo yum install -y docker
sudo systemctl enable --now docker

# Terraform (Amazon Linux 2)
sudo yum install -y yum-utils
sudo yum-config-manager --add-repo https://rpm.releases.hashicorp.com/AmazonLinux/hashicorp.repo
sudo yum install terraform -y

# Terraform workflow
terraform init
terraform plan
terraform apply
                </code></pre>

                <p class="mb-2"><b>Correctif “Node Group”</b> (erreur CREATE_FAILED) :</p>
                <pre><code>// Dans la définition des subnets publics
map_public_ip_on_launch = true
                </code></pre>

                <p class="mb-2"><b>Outputs utiles</b> (exemples) :</p>
                <pre><code>output "cluster_name"   { value = aws_eks_cluster.main.name }
output "cluster_endpoint" { value = aws_eks_cluster.main.endpoint }
output "oidc_issuer"      { value = aws_eks_cluster.main.identity[0].oidc[0].issuer }
                </code></pre>
              </div>
            </div>
          </div>

          <!-- Détail des fichiers -->
          <div class="faq-item">
            <div class="question" onclick="toggleAnswer('ans2', this)">
              Détail des fichiers du projet (.tf & Java)
              <span class="arrow"><i class="bx bx-chevron-down"></i></span>
            </div>
            <div class="answer" id="ans2">
              <div class="p-2">
                <p><b>Arborescence (exemple)</b></p>
                <pre><code>infra/
├─ provider.tf       # Region, authentification AWS
├─ variables.tf      # Noms cluster, CIDR, AZs, tailles, versions…
├─ main.tf           # VPC/Subnets/Routes + EKS + Node Group + SG
├─ iam.tf            # Rôles & policies (EKS, nodes, Lambda)
├─ outputs.tf        # Valeurs de sortie (endpoint, OIDC, etc.)
hello-lambda/
├─ pom.xml
├─ src/main/java/com/infoline/lambda/App.java
                </code></pre>

                <p class="mb-1"><b>provider.tf :</b> région + provider AWS.</p>
                <pre><code>provider "aws" {
  region = var.aws_region
}
                </code></pre>

                <p class="mb-1"><b>variables.tf :</b> toutes les variables paramétrables (noms, versions, CIDR, tailles, etc.).</p>
                <pre><code>variable "aws_region"   { default = "eu-west-3" }
variable "cluster_name" { default = "info-eks-cluster" }
variable "vpc_cidr"     { default = "172.31.0.0/16" }
                </code></pre>

                <p class="mb-1"><b>main.tf :</b> déclaration du VPC, subnets, routes, SG, <b>aws_eks_cluster</b>, <b>aws_eks_node_group</b>.</p>

                <p class="mb-1"><b>iam.tf :</b> rôles/policies pour EKS, nodes et Lambda (attach policies gérées + inline si besoin).</p>

                <p class="mb-1"><b>App.java (Lambda) :</b> handler simple (Java 11).</p>
                <pre><code class="language-java">public class App implements com.amazonaws.services.lambda.runtime.RequestHandler&lt;String, String&gt; {
  @Override
  public String handleRequest(String input, com.amazonaws.services.lambda.runtime.Context context) {
    return "Bonjour depuis AWS Lambda, tu m’as dit : " + input;
  }
}
                </code></pre>

                <p class="mb-1"><b>pom.xml :</b> dépendances et plugin de compilation (Java 1.8/11 selon runtime choisi).</p>
                <pre><code>&lt;dependency&gt;
  &lt;groupId&gt;com.amazonaws&lt;/groupId&gt;
  &lt;artifactId&gt;aws-lambda-java-core&lt;/artifactId&gt;
  &lt;version&gt;1.2.1&lt;/version&gt;
&lt;/dependency&gt;

&lt;plugin&gt;
  &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
  &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
  &lt;version&gt;3.8.1&lt;/version&gt;
  &lt;configuration&gt;
    &lt;source&gt;1.8&lt;/source&gt;
    &lt;target&gt;1.8&lt;/target&gt;
  &lt;/configuration&gt;
&lt;/plugin&gt;
                </code></pre>
              </div>
            </div>
          </div>

          <!-- Déploiement & tests -->
          <div class="faq-item">
            <div class="question" onclick="toggleAnswer('ans3', this)">
              Déploiement & tests (EKS + Lambda)
              <span class="arrow"><i class="bx bx-chevron-down"></i></span>
            </div>
            <div class="answer" id="ans3">
              <div class="p-2">
                <p><b>Cluster EKS</b></p>
                <ul>
                  <li><code>terraform apply</code> → création VPC/Subnets/Routes/SG + EKS + Node Group.</li>
                  <li>Vérif console : <em>Cluster health = 0 issues</em>, endpoint exposé, OIDC actif.</li>
                </ul>

                <p><b>Lambda Java</b></p>
                <pre><code class="language-bash"># Compilation sur EC2
sudo yum install -y maven
mvn -f hello-lambda/pom.xml clean package

# Artefact: hello-lambda/target/hello-lambda-1.0-SNAPSHOT.jar
# Upload dans la console Lambda (runtime Java 11)
# Handler: com.infoline.lambda.App::handleRequest
                </code></pre>

                <p><b>Test console</b> (événement JSON simple) → <em>réponse correcte</em> avec la chaîne renvoyée.</p>
              </div>
            </div>
          </div>

          <!-- Problèmes & solutions -->
          <div class="faq-item">
            <div class="question" onclick="toggleAnswer('ans4', this)">
              Problèmes rencontrés & solutions
              <span class="arrow"><i class="bx bx-chevron-down"></i></span>
            </div>
            <div class="answer" id="ans4">
              <div class="p-2">
                <table class="table table-sm">
                  <thead><tr><th style="width:45%">Problème</th><th>Solution</th></tr></thead>
                  <tbody>
                    <tr>
                      <td><b>CREATE_FAILED</b> sur le <i>Node Group</i> (nodes injoignables)</td>
                      <td>Forcer <code>map_public_ip_on_launch = true</code> sur les subnets publics.</td>
                    </tr>
                    <tr>
                      <td>Instances EC2 “fantômes”/ressources qui se relancent</td>
                      <td>Suppression manuelle des Node Groups/Clusters côté console EKS puis <code>terraform destroy</code>.</td>
                    </tr>
                    <tr>
                      <td>Compilation Maven : <i>source release 5 is no longer supported</i></td>
                      <td>Configurer <b>maven-compiler-plugin</b> en 1.8 (ou 11) dans le <code>pom.xml</code>.</td>
                    </tr>
                    <tr>
                      <td>Handler Lambda non reconnu</td>
                      <td>Vérifier le <b>package</b> Java et le handler : <code>com.infoline.lambda.App::handleRequest</code>.</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Nettoyage & coûts -->
          <div class="faq-item">
            <div class="question" onclick="toggleAnswer('ans5', this)">
              Nettoyage & maîtrise des coûts
              <span class="arrow"><i class="bx bx-chevron-down"></i></span>
            </div>
            <div class="answer" id="ans5">
              <div class="p-2">
                <ul>
                  <li><b>Destroy IaC :</b> <code>terraform destroy</code> après avoir vidé les dépendances (Node Groups → Cluster).</li>
                  <li><b>EC2 :</b> arrêter/terminer la VM d’orchestration si elle n’est plus utilisée.</li>
                  <li><b>Conseil :</b> surveiller la console Billing + activer alertes budgétaires pour éviter toute surprise.</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Bonnes pratiques -->
          <div class="faq-item">
            <div class="question" onclick="toggleAnswer('ans6', this)">
              Sécurité & bonnes pratiques minimales
              <span class="arrow"><i class="bx bx-chevron-down"></i></span>
            </div>
            <div class="answer" id="ans6">
              <div class="p-2">
                <ul>
                  <li>Principe du <b>moindre privilège</b> sur les <b>roles/policies IAM</b>.</li>
                  <li>Clé <code>.pem</code> protégée ; accès SSH restreint (IP source, SG).</li>
                  <li>Pas de secrets en clair dans les sources — privilégier <em>variables d’environnement</em> ou AWS Secrets Manager.</li>
                  <li>Versionner l’IaC, activer un <b>formatage</b> (<code>terraform fmt</code>) et un <b>lint</b> si possible.</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Commandes utiles -->
          <div class="faq-item">
            <div class="question" onclick="toggleAnswer('ans7', this)">
              Commandes utiles
              <span class="arrow"><i class="bx bx-chevron-down"></i></span>
            </div>
            <div class="answer" id="ans7">
              <div class="p-2">
                <pre><code class="language-bash"># Terraform
terraform fmt && terraform validate
terraform plan -out=tfplan
terraform apply tfplan
terraform destroy

# Maven
mvn -f hello-lambda/pom.xml clean package

# (facultatif) Kubectl une fois le kubeconfig récupéré
aws eks update-kubeconfig --region &lt;region&gt; --name info-eks-cluster
kubectl get nodes
                </code></pre>
              </div>
            </div>
          </div>

        </div>
      </div>

    </div>
  </section><!-- End Portfolio Details -->
</main>

<a href="#" class="back-to-top"><i class="bx bx-up-arrow-alt"></i></a>
<div id="preloader"></div>

<!-- Vendor JS -->
<script src="assets/vendor/jquery/jquery.min.js"></script>
<script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="assets/vendor/jquery.easing/jquery.easing.min.js"></script>
<script src="assets/vendor/venobox/venobox.min.js"></script>
<script src="assets/vendor/waypoints/jquery.waypoints.min.js"></script>
<script src="assets/vendor/counterup/counterup.min.js"></script>
<script src="assets/vendor/owl.carousel/owl.carousel.min.js"></script>
<script src="assets/vendor/typed.js/typed.min.js"></script>
<script src="assets/vendor/aos/aos.js"></script>
<link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">



<!-- Template JS -->
<script src="assets/js/main.js"></script>

<script>
  // Accordéon
  function toggleAnswer(id, el){
    const ans = document.getElementById(id);
    const open = ans.classList.contains('answer-visible');
    document.querySelectorAll('.answer').forEach(a=>a.classList.remove('answer-visible'));
    document.querySelectorAll('.question').forEach(q=>q.classList.remove('answer-visible'));
    if(!open){ ans.classList.add('answer-visible'); el.classList.add('answer-visible'); }
  }
</script>
</body>
</html>
